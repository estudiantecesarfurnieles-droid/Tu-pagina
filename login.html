<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ’– Acceso a Nuestro Universo ğŸ’–</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/login.css" />
  
  <!-- VERIFICACIÃ“N INMEDIATA -->
  <script>
    // Verificar si ya estÃ¡ autenticado
    function verificarSiYaEstaAutenticado() {
      const usuario = localStorage.getItem('usuarioAutenticado');
      const autenticado = localStorage.getItem('esAutenticado');
      
      if (usuario && autenticado === 'true') {
        console.log('âœ… Usuario ya autenticado, redirigiendo a la pÃ¡gina principal...');
        window.location.href = '/';
      }
    }
    
    // Ejecutar verificaciÃ³n
    verificarSiYaEstaAutenticado();
  </script>
</head>
<body>
  <!-- Fondo animado con partÃ­culas -->
  <div class="login-background">
    <div class="floating-hearts">
      <div class="heart">ğŸ’–</div>
      <div class="heart">ğŸ’•</div>
      <div class="heart">ğŸ’</div>
      <div class="heart">ğŸ’—</div>
      <div class="heart">ğŸ’˜</div>
      <div class="heart">ğŸ’</div>
    </div>
    <div class="floating-stars">
      <div class="star">âœ¨</div>
      <div class="star">â­</div>
      <div class="star">ğŸŒŸ</div>
      <div class="star">ğŸ’«</div>
    </div>
  </div>

  <!-- Contenedor principal del login -->
  <div class="login-container">
    <div class="login-card">
      <!-- Header romÃ¡ntico -->
      <div class="login-header">
        <div class="login-hearts">
          <span class="heart-pulse">ğŸ’–</span>
          <span class="heart-pulse">ğŸ’•</span>
          <span class="heart-pulse">ğŸ’</span>
        </div>
        <h1 class="login-title">Nuestro Universo de Amor</h1>
        <p class="login-subtitle">Ingresa para acceder a nuestro mundo especial</p>
      </div>

      <!-- Formulario de login -->
      <div class="login-form-container">
        <form id="loginForm" class="login-form">
          <div class="form-group">
            <label for="username" class="form-label">
              <span class="label-icon">ğŸ‘¤</span>
              Usuario
            </label>
            <input 
              type="text" 
              id="username" 
              name="username" 
              class="form-input" 
              placeholder="Ingresa tu nombre de usuario"
              required
              autocomplete="username"
            />
          </div>

          <div class="form-group">
            <label for="password" class="form-label">
              <span class="label-icon">ğŸ”’</span>
              ContraseÃ±a
            </label>
            <input 
              type="password" 
              id="password" 
              name="password" 
              class="form-input" 
              placeholder="Ingresa tu contraseÃ±a"
              required
              autocomplete="current-password"
            />
          </div>

          <button type="submit" class="login-btn" id="loginBtn">
            <span class="btn-icon">ğŸ’•</span>
            <span class="btn-text">Ingresar al Universo</span>
            <span class="btn-loading hidden">â³</span>
          </button>
        </form>

        <!-- Formulario de registro (solo aparece si no hay usuario creado) -->
        <div id="registerSection" class="register-section">
          <div class="divider">
            <span class="divider-text">âœ¨ Primera vez âœ¨</span>
          </div>
          
          <form id="registerForm" class="register-form">
            <div class="form-group">
              <label for="newUsername" class="form-label">
                <span class="label-icon">ğŸ‘¤</span>
                Crear Usuario
              </label>
              <input 
                type="text" 
                id="newUsername" 
                name="newUsername" 
                class="form-input" 
                placeholder="Elige tu nombre de usuario"
                required
                autocomplete="username"
              />
            </div>

            <div class="form-group">
              <label for="newPassword" class="form-label">
                <span class="label-icon">ğŸ”’</span>
                Crear ContraseÃ±a
              </label>
              <input 
                type="password" 
                id="newPassword" 
                name="newPassword" 
                class="form-input" 
                placeholder="Crea una contraseÃ±a segura"
                required
                autocomplete="new-password"
              />
            </div>

            <div class="form-group">
              <label for="confirmPassword" class="form-label">
                <span class="label-icon">ğŸ”</span>
                Confirmar ContraseÃ±a
              </label>
              <input 
                type="password" 
                id="confirmPassword" 
                name="confirmPassword" 
                class="form-input" 
                placeholder="Confirma tu contraseÃ±a"
                required
                autocomplete="new-password"
              />
            </div>

            <button type="submit" class="register-btn" id="registerBtn">
              <span class="btn-icon">ğŸ’–</span>
              <span class="btn-text">Crear Usuario</span>
              <span class="btn-loading hidden">â³</span>
            </button>
          </form>
        </div>
      </div>

      <!-- Mensajes de estado -->
      <div id="messageContainer" class="message-container hidden">
        <div id="messageContent" class="message-content"></div>
      </div>

      <!-- Footer romÃ¡ntico -->
      <div class="login-footer">
        <p class="footer-text">
          <span class="emoji">ğŸ’•</span>
          Un lugar especial para nosotros dos
          <span class="emoji">ğŸ’•</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // SISTEMA DE LOGIN SIMPLE SIN BASE DE DATOS
    class SimpleLoginSystem {
      constructor() {
        this.maxUsers = 2;
        this.init();
      }

      init() {
        console.log('ğŸš€ Inicializando sistema de login...');
        this.setupEventListeners();
        this.checkUserCount();
      }

      setupEventListeners() {
        // Formulario de login
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
          loginForm.addEventListener('submit', (e) => this.handleLogin(e));
        }

        // Formulario de registro
        const registerForm = document.getElementById('registerForm');
        if (registerForm) {
          registerForm.addEventListener('submit', (e) => this.handleRegister(e));
        }
      }

      checkUserCount() {
        const users = this.getStoredUsers();
        console.log('ğŸ‘¥ Usuarios registrados:', users.length);
        
        if (users.length >= this.maxUsers) {
          this.hideRegisterSection();
          this.showMaxUsersMessage(users.length);
        } else {
          this.showRegisterSection();
          this.updateRegisterMessage(users.length);
        }
      }

      getStoredUsers() {
        const users = localStorage.getItem('usuariosRegistrados');
        return users ? JSON.parse(users) : [];
      }

      storeUsers(users) {
        localStorage.setItem('usuariosRegistrados', JSON.stringify(users));
      }

      showRegisterSection() {
        const registerSection = document.getElementById('registerSection');
        if (registerSection) {
          registerSection.classList.remove('hidden');
        }
      }

      hideRegisterSection() {
        const registerSection = document.getElementById('registerSection');
        if (registerSection) {
          registerSection.classList.add('hidden');
        }
      }

      updateRegisterMessage(count) {
        const dividerText = document.querySelector('.divider-text');
        if (dividerText && count > 0) {
          dividerText.textContent = `âœ¨ Registro disponible (${count}/${this.maxUsers} usuarios) âœ¨`;
        }
      }

      showMaxUsersMessage(count) {
        const messageContainer = document.getElementById('messageContainer');
        const messageContent = document.getElementById('messageContent');
        
        if (messageContainer && messageContent) {
          messageContent.textContent = `Se han registrado ${count} usuarios (mÃ¡ximo ${this.maxUsers}). Solo puedes hacer login.`;
          messageContent.className = 'message-content info';
          messageContainer.classList.remove('hidden');
        }
      }

      async handleLogin(e) {
        e.preventDefault();
        console.log('ğŸ” Procesando login...');
        
        const formData = new FormData(e.target);
        const username = formData.get('username').trim();
        const password = formData.get('password');

        // ValidaciÃ³n bÃ¡sica
        if (!username || !password) {
          this.showMessage('Por favor completa todos los campos', 'error');
          return;
        }

        this.setLoading(true, 'loginBtn');

        try {
          const users = this.getStoredUsers();
          const user = users.find(u => u.username === username && u.password === password);
          
          if (user) {
            console.log('âœ… Login exitoso para:', username);
            this.showMessage('Â¡Bienvenido al universo! ğŸ’•', 'success');
            
            // Guardar sesiÃ³n
            localStorage.setItem('usuarioAutenticado', username);
            localStorage.setItem('esAutenticado', 'true');
            
            // Redirigir despuÃ©s de un breve delay
            setTimeout(() => {
              window.location.href = '/';
            }, 1500);
          } else {
            console.log('âŒ Credenciales incorrectas');
            this.showMessage('Credenciales incorrectas', 'error');
          }
        } catch (error) {
          console.error('Login error:', error);
          this.showMessage('Error de conexiÃ³n. Intenta nuevamente.', 'error');
        } finally {
          this.setLoading(false, 'loginBtn');
        }
      }

      async handleRegister(e) {
        e.preventDefault();
        console.log('ğŸ“ Procesando registro...');
        
        const formData = new FormData(e.target);
        const username = formData.get('newUsername').trim();
        const password = formData.get('newPassword');
        const confirmPassword = formData.get('confirmPassword');

        // Validaciones
        if (!username || !password || !confirmPassword) {
          this.showMessage('Por favor completa todos los campos', 'error');
          return;
        }

        if (username.length < 3) {
          this.showMessage('El usuario debe tener al menos 3 caracteres', 'error');
          return;
        }

        if (password.length < 6) {
          this.showMessage('La contraseÃ±a debe tener al menos 6 caracteres', 'error');
          return;
        }

        if (password !== confirmPassword) {
          this.showMessage('Las contraseÃ±as no coinciden', 'error');
          return;
        }

        this.setLoading(true, 'registerBtn');

        try {
          const users = this.getStoredUsers();
          
          // Verificar si ya existen 2 usuarios
          if (users.length >= this.maxUsers) {
            this.showMessage('Ya se han registrado el mÃ¡ximo de usuarios permitidos (2)', 'error');
            return;
          }

          // Verificar si el usuario ya existe
          if (users.find(u => u.username === username)) {
            this.showMessage('Este usuario ya existe', 'error');
            return;
          }

          // Crear nuevo usuario
          const newUser = {
            username: username,
            password: password,
            createdAt: new Date().toISOString()
          };

          users.push(newUser);
          this.storeUsers(users);

          console.log('âœ… Usuario creado exitosamente:', username);
          this.showMessage('Â¡Usuario creado exitosamente! ğŸ’–', 'success');
            
          // Guardar sesiÃ³n
          localStorage.setItem('usuarioAutenticado', username);
          localStorage.setItem('esAutenticado', 'true');
            
          // Ocultar secciÃ³n de registro si se alcanzÃ³ el mÃ¡ximo
          if (users.length >= this.maxUsers) {
            this.hideRegisterSection();
          }
            
          // Redirigir despuÃ©s de un breve delay
          setTimeout(() => {
            window.location.href = '/';
          }, 1500);
            
        } catch (error) {
          console.error('Register error:', error);
          this.showMessage('Error al crear usuario', 'error');
        } finally {
          this.setLoading(false, 'registerBtn');
        }
      }

      setLoading(loading, buttonId) {
        const button = document.getElementById(buttonId);
        
        if (button) {
          const btnText = button.querySelector('.btn-text');
          const btnLoading = button.querySelector('.btn-loading');
          
          if (loading) {
            button.disabled = true;
            button.classList.add('loading');
            if (btnText) btnText.style.opacity = '0.7';
            if (btnLoading) btnLoading.classList.remove('hidden');
          } else {
            button.disabled = false;
            button.classList.remove('loading');
            if (btnText) btnText.style.opacity = '1';
            if (btnLoading) btnLoading.classList.add('hidden');
          }
        }
      }

      showMessage(message, type = 'info') {
        const messageContainer = document.getElementById('messageContainer');
        const messageContent = document.getElementById('messageContent');
        
        if (messageContainer && messageContent) {
          messageContent.textContent = message;
          messageContent.className = `message-content ${type}`;
          messageContainer.classList.remove('hidden');
          
          // Auto-ocultar despuÃ©s de 5 segundos
          setTimeout(() => {
            messageContainer.classList.add('hidden');
          }, 5000);
        }
      }
    }

    // Inicializar el sistema cuando se carga la pÃ¡gina
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ“„ PÃ¡gina cargada, inicializando sistema de login...');
      new SimpleLoginSystem();
    });
  </script>
</body>
</html>